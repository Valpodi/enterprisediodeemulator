version: "3"
services:
  tester:
    build:
      context: ./
      dockerfile: ./TesterDockerfile
    volumes:
      - ./emulatorTests.py:/tmp/emulatorTests.py
      - ./importEmulatorTests.py:/tmp/importEmulatorTests.py
      - ./test_helpers.py:/tmp/test_helpers.py
      - ./:/tmp/results/
    entrypoint: "python3 -m nose --with-xunit --xunit-file=/tmp/results/${RESULT_FILENAME} ${PYTHON_SCRIPT}"
  diode_emulator:
    build:
      context: ../Emulator
      dockerfile: Dockerfile
    environment:
      - IMPORTDIODE=${IMPORT_DIODE}
    volumes:
      - ../Emulator/config/portConfig.json:/usr/src/app/portConfig.json
    entrypoint: "python3 -u /usr/src/app/emulator.py"